<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.49.2" />
  <meta name="author" content="Jason Bryer, Ph.D.">

  
  
  
  
    
      
    
  
  <meta name="description" content="Data caching is not new. It is often necessary to save intermediate data files when the process of loading and/or manipulating data takes a considerable amount of time. This problem is further complicated when working with dynamic data that changes regularly. In these situations it often sufficient to use data that is current with in some time frame (e.g. hourly, daily, weekly, monthly). One solution is to use a time-based job scheduler such as cron.">

  
  <link rel="alternate" hreflang="en-us" href="/post/2014-07-29-data_caching/">

  


  

  
  
  <meta name="theme-color" content="#3f51b5">
  
  
  
  
    
  
  
    
    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
    
  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha512-6MXa8B6uaO18Hid6blRMetEIoPqHf7Ux1tnyIQdpt9qI5OACx7C+O3IVTr98vwGnlcg0LOLa02i9Y1HpVhlfiw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.1/css/academicons.min.css" integrity="sha512-NThgw3XKQ1absAahW6to7Ey42uycrVvfNfyjqcFNgCmOCQ5AR4AO0SiXrN+8ZtYeappp56lk1WtvjVmEa+VR6A==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">
  
  
  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700%7cRoboto:400,400italic,700%7cRoboto&#43;Mono">
  
  <link rel="stylesheet" href="/styles.css">
  

  

  
  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="Jason Bryer">
  <link rel="feed" href="/index.xml" type="application/rss+xml" title="Jason Bryer">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/post/2014-07-29-data_caching/">

  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@jbryer">
  <meta property="twitter:creator" content="@jbryer">
  
  <meta property="og:site_name" content="Jason Bryer">
  <meta property="og:url" content="/post/2014-07-29-data_caching/">
  <meta property="og:title" content="Data Caching | Jason Bryer">
  <meta property="og:description" content="Data caching is not new. It is often necessary to save intermediate data files when the process of loading and/or manipulating data takes a considerable amount of time. This problem is further complicated when working with dynamic data that changes regularly. In these situations it often sufficient to use data that is current with in some time frame (e.g. hourly, daily, weekly, monthly). One solution is to use a time-based job scheduler such as cron.">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2014-07-29T21:13:14-05:00">
  
  <meta property="article:modified_time" content="2014-07-29T21:13:14-05:00">
  

  

  <title>Data Caching | Jason Bryer</title>

</head>
<body id="top" data-spy="scroll" data-target="#toc" data-offset="71" >

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
      <a class="navbar-brand" href="/">Jason Bryer</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      
      <ul class="nav navbar-nav navbar-right">
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#about">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/post">
            
            <span>Posts</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#projects">
            
            <span>Projects</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/talk">
            
            <span>Talks</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#teaching">
            
            <span>Teaching</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
            
          
        

        <li class="nav-item">
          <a href="http://cv.bryer.org" target="_blank" rel="noopener">
            
            <span>CV</span>
            
          </a>
        </li>

        
        
      

      
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  


  <div class="article-container">
    <h1 itemprop="name">Data Caching</h1>

    

<div class="article-metadata">

  <span class="article-date">
    
    <time datetime="2014-07-29 21:13:14 -0500 -0500" itemprop="datePublished dateModified">
      July 29, 2014
    </time>
  </span>
  <span itemscope itemprop="author publisher" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Jason Bryer, Ph.D.">
  </span>

  

  
  

  
  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fa fa-folder"></i>
    
    <a href="/categories/r">R</a
    >
    
  </span>
  
  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Data%20Caching&amp;url=%2fpost%2f2014-07-29-data_caching%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=%2fpost%2f2014-07-29-data_caching%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fpost%2f2014-07-29-data_caching%2f&amp;title=Data%20Caching"
         target="_blank" rel="noopener">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=%2fpost%2f2014-07-29-data_caching%2f&amp;title=Data%20Caching"
         target="_blank" rel="noopener">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Data%20Caching&amp;body=%2fpost%2f2014-07-29-data_caching%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>


    <div class="article-style" itemprop="articleBody">
      <p>Data caching is not new. It is often necessary to save intermediate data files when the process of loading and/or manipulating data takes a considerable amount of time. This problem is further complicated when working with dynamic data that changes regularly. In these situations it often sufficient to use data that is current with in some time frame (e.g. hourly, daily, weekly, monthly). One solution is to use a time-based job scheduler such as <code>cron</code>. However, that requires access and knowledge of Unix systems. The alternative, is to check for the &ldquo;freshness&rdquo; of a cached dataset each time it is requested. If is &ldquo;stale,&rdquo; then the data cached is refreshed with more up-to-date data. The <code>DataCache</code> package implements this approach in R. Moreover, on Unix systems (including Mac OS X), the refreshing will be done in the background. That is, when requesting data from the cache, if it is stale, the function will return the latest available data while the cache is updated in the background. This is particularly useful when using R in a web environment (e.g. <a href="http://shiny.rstudio.com" target="_blank">Shiny Apps</a>) where it is not ideal to have the user wait for data be loaded to begin interacting with the app.</p>

<p>The latest version of the <code>DataCache</code> package can be downloaded from Github using the <code>devtools</code> package.</p>

<pre><code class="language-r">devtools::install_github('jbryer/DataCache')
</code></pre>

<p>For this example, we wish to periodically load weather data using the <code>weatherData</code> package. The <code>getDetailedWeather</code> function provides hourly temperature updates. To start, we will load the <code>DataCache</code> and <code>weatherData</code> packages.</p>

<pre><code class="language-r">library('DataCache')
library('weatherData')
</code></pre>

<p>The only required parameter for the <code>data.cache</code> function is the <code>FUN</code> parameter which defines the data to be loaded. This function should return a named <code>list</code> where each element of the list will be assigned to specified environment when loaded. That is, if the function returns <code>list(foo='bar')</code> then the object <code>foo</code> will be assigned in the working envirnoment (note that this can be modified using the <code>envir</code> parameter).</p>

<pre><code class="language-r">#' Load data for a single day for the given airport.
#' @param station_id three letter airport code.
#' @return a list with a data frame names `weather.XXX` where `XXX` is the three
#'         letter airport code.
loadWeatherData &lt;- function(station_id='ALB') {
	results &lt;- list(getDetailedWeather(station_id, Sys.Date()))
	names(results) &lt;- paste0('weather.', station_id)
	return(results)
}
</code></pre>

<p>To get started, simply call <code>data.cache</code> with the data loading function. This function will block on the first execution (i.e. you will have to wait until the first dataset is loaded). On subsequent executions, the <code>data.cache</code> function will check to see if the most recent cached data is stale. If it is stale, it will start a new background process to load the data and return the most recent data. Once the background process completes, <code>data.cache</code> will start returning the updated data.</p>

<p>Note for Windows users: Forking is not available on Windows systems using the <code>parallel</code> package. Therefore data cannot be loaded in the background. As a result, the <code>data.cache</code> function will wait for the refreshed data to load each time it becomes stale.</p>

<p>The <code>data.cache</code> returns invisibly (i.e. will not be printed if not assinged to a variable, see <code>?invisible</code> for more details) the timestamp of the data returned.</p>

<pre><code class="language-r">(cache.date1 &lt;- data.cache(loadWeatherData))
</code></pre>

<pre><code>No cached data found. Loading intial data...
</code></pre>

<pre><code>[1] &quot;2014-07-29 18:03:53 EDT&quot;
</code></pre>

<pre><code class="language-r">head(weather.ALB)
</code></pre>

<pre><code>                 Time TemperatureF
1 2014-07-29 00:51:00         62.1
2 2014-07-29 01:51:00         61.0
3 2014-07-29 02:51:00         61.0
4 2014-07-29 03:51:00         61.0
5 2014-07-29 04:51:00         60.1
6 2014-07-29 05:51:00         59.0
</code></pre>

<p>The <code>cache.info</code> function provides a summary of all the cached data files. It will also provide columns (which can be set using the <code>stale</code> parameter) indicating whether that data file is stale according to various time periods.</p>

<pre><code class="language-r">cache.info()
</code></pre>

<pre><code>                          file             created age_mins hourly_stale
1 Cache2014-07-29 18:03:53.rda 2014-07-29 18:03:53   0.1842        FALSE
  daily_stale weekly_stale monthly_stale yearly_stale
1       FALSE        FALSE         FALSE        FALSE
</code></pre>

<p>Old data caches can easily be loaded this way. For example, the following will load the first data cache created:</p>

<pre><code class="language-r">cinfo &lt;- cache.info()
load(cinfo[nrow(cinfo),]$file)
</code></pre>

<p>There are a number of frequencies available for defining when a dataset becomes stale. They are:</p>

<ul>
<li><code>hourly</code> - Data will become stale each hour. This uses the <code>hour</code> function from the <code>lubrdiate</code> package. Therefore, data will become stale at the top of each hour.</li>
<li><code>daily</code> - Data will become stale each day (i.e. at midnight).</li>
<li><code>weekly</code> - Data will become stale each week. The day of week will vary depending on what day of the week January 1st occurs.</li>
<li><code>montly</code> - Data will become stale each month (i.e. on the 1st of the month).</li>
<li><code>yearly</code> - Data will become stale each year (i.e. on January 1st).</li>
<li><code>nMinutes</code> - Data will become stale if last loaded more than <em>n</em> minutes ago.</li>
<li><code>nHours</code> - Data will become stale if last loaded more than <em>n</em> hours ago.</li>
<li><code>nDays</code> - Data will become stale if last laoded more than <em>n</em> days ago.</li>
</ul>

<p>You can define your own frequency. Simply define a function that takes one parameter, <code>timestamp</code>, and returns a logical where <code>TRUE</code> indicates the data loaded at <code>timestamp</code> is stale.</p>

<p>We can see that the <code>weather.ALB</code> data frame is now available in the working environent.</p>

<pre><code class="language-r">ls()
</code></pre>

<pre><code>[1] &quot;cache.date1&quot;     &quot;loadWeatherData&quot; &quot;package&quot;         &quot;weather.ALB&quot;
</code></pre>

<p>We will wait 60 seconds so that the cache becomes stale. We will also call <code>data.cache</code> twice in a row to show that they will each return the same cached data, but the second call will not spawn a new background process to refresh the data.</p>

<pre><code class="language-r">Sys.sleep(60)
(cache.date2 &lt;- data.cache(loadWeatherData, frequency=nMinutes(1)))
</code></pre>

<pre><code>Loading more recent data, returning lastest available.
</code></pre>

<pre><code>[1] &quot;2014-07-29 18:03:53 EDT&quot;
</code></pre>

<pre><code class="language-r">(cache.date3 &lt;- data.cache(loadWeatherData, frequency=nMinutes(1)))
</code></pre>

<pre><code>Data is being loaded by another process. The process has been running for 0.121761083602905 seconds. If this is an error delete cache/Cache.lck
Loading more recent data, returning lastest available.
</code></pre>

<pre><code>[1] &quot;2014-07-29 18:03:53 EDT&quot;
</code></pre>

<p>It is easy to have multiple data caches. Using the same <code>loadWeatherData</code> function we will create a spearate data cache for weather data from JFK.</p>

<pre><code class="language-r">data.cache(loadWeatherData, cache.name='NRT', station_id='NRT')
</code></pre>

<pre><code>No cached data found. Loading intial data...
</code></pre>

<pre><code class="language-r">head(weather.NRT)
</code></pre>

<pre><code>                 Time TemperatureF
1 2014-07-29 00:00:00         69.8
2 2014-07-29 00:30:00         68.0
3 2014-07-29 01:00:00         68.0
4 2014-07-29 01:30:00         68.0
5 2014-07-29 02:00:00         66.2
6 2014-07-29 02:30:00         66.2
</code></pre>

<pre><code class="language-r">cache.info(cache.name='NRT')
</code></pre>

<pre><code>                        file             created age_mins hourly_stale
1 NRT2014-07-29 18:05:04.rda 2014-07-29 18:05:04  0.03819        FALSE
  daily_stale weekly_stale monthly_stale yearly_stale
1       FALSE        FALSE         FALSE        FALSE
</code></pre>

    </div>

    


<div class="article-tags">
  
  <a class="btn btn-primary btn-outline" href="/tags/r">R</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/r-bloggers">R-Bloggers</a>
  
</div>




    
    
    <div class="article-widget">
      <div class="hr-light"></div>
      <h3>Related</h3>
      <ul>
        
        <li><a href="/post/2014-07-04-women_graduates_in_math_stats_cis/">Women Graduates in Math, Statistics, and Computer Information Systems</a></li>
        
        <li><a href="/post/2014-07-03-user_2014_psaboot_slides/">useR 2014 Slides for PSAboot and version 1.1. on CRAN</a></li>
        
        <li><a href="/post/2014-06-05-str_implementation_for_data_frames/">str Implementation for Data Frames</a></li>
        
        <li><a href="/post/2014-04-22-rgitbook_package/">Rgitbook Package for Using R Markdown with Gitbook</a></li>
        
        <li><a href="/post/2014-03-20-albany_r_users_group/">Albany, NY R Users Group</a></li>
        
      </ul>
    </div>
    

    

    
<section id="comments">
  <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "jbryer" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>



  </div>
</article>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      &copy; 2020 &middot; 

      Powered by the
      <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
      <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.
      <br/>Some <a href="http://www.bryer.org/tags/r-bloggers/">posts</a> generously redistributed by <a href="https://www.r-bloggers.com/" target="_blank">R-Bloggers</a>.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close btn-large" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Cite</h4>
      </div>
      <div>
        <pre><code class="modal-body tex"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-primary btn-outline js-copy-cite" href="#" target="_blank">
          <i class="fa fa-copy"></i> Copy
        </a>
        <a class="btn btn-primary btn-outline js-download-cite" href="#" target="_blank">
          <i class="fa fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    

    

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha512-3P8rXCuGJdNZOnUx/03c1jOTnMn3rP63nBip5gOP2qmUh5YAdVAvFZ1E+QLZZbC1rtMrQb+mah3AfYW11RUrWA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha512-iztkobsvnjKfAtTNdHkGVjAYTrrtlC7mGp/54c40wowO7LhURYl3gVzzcEqGl/qKXQltJ2HwMrdLcNUdo+N/RQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>
    
    
    <script src="/js/hugo-academic.js"></script>
    

    
    
      
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
      

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    

  </body>
</html>

