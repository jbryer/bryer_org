<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.54.0" />
  <meta name="author" content="Jason Bryer, Ph.D.">

  
  
  
  
    
      
    
  
  <meta name="description" content="TL;DR: You can test this approach using this Github Gist.
R Shiny Apps have become a popular way of creating web applications in R. There are many ways of running Shiny Apps including locally in RStudio, on Shinyapps.io or installing the server software on your own host. I have been increasingly using Shiny apps as a way to demonstrate and interact with R Packages, especially packages I write for teaching purposes.">

  
  <link rel="alternate" hreflang="en-us" href="/post/2021-02-12-shiny_apps_in_r_packages/">

  


  

  
  
  <meta name="theme-color" content="#3f51b5">
  
  
  
  
    
  
  
    
    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
    
  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha512-6MXa8B6uaO18Hid6blRMetEIoPqHf7Ux1tnyIQdpt9qI5OACx7C+O3IVTr98vwGnlcg0LOLa02i9Y1HpVhlfiw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.1/css/academicons.min.css" integrity="sha512-NThgw3XKQ1absAahW6to7Ey42uycrVvfNfyjqcFNgCmOCQ5AR4AO0SiXrN+8ZtYeappp56lk1WtvjVmEa+VR6A==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">
  
  
  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700%7cRoboto:400,400italic,700%7cRoboto&#43;Mono">
  
  <link rel="stylesheet" href="/styles.css">
  

  

  
  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="Jason Bryer">
  <link rel="feed" href="/index.xml" type="application/rss+xml" title="Jason Bryer">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/post/2021-02-12-shiny_apps_in_r_packages/">

  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@jbryer">
  <meta property="twitter:creator" content="@jbryer">
  
  <meta property="og:site_name" content="Jason Bryer">
  <meta property="og:url" content="/post/2021-02-12-shiny_apps_in_r_packages/">
  <meta property="og:title" content="Framework for Shiny Apps in R Packages | Jason Bryer">
  <meta property="og:description" content="TL;DR: You can test this approach using this Github Gist.
R Shiny Apps have become a popular way of creating web applications in R. There are many ways of running Shiny Apps including locally in RStudio, on Shinyapps.io or installing the server software on your own host. I have been increasingly using Shiny apps as a way to demonstrate and interact with R Packages, especially packages I write for teaching purposes.">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2021-02-12T00:00:00&#43;00:00">
  
  <meta property="article:modified_time" content="2021-02-12T00:00:00&#43;00:00">
  

  

  <title>Framework for Shiny Apps in R Packages | Jason Bryer</title>

</head>
<body id="top" data-spy="scroll" data-target="#toc" data-offset="71" >

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
      <a class="navbar-brand" href="/">Jason Bryer</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      
      <ul class="nav navbar-nav navbar-right">
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#about">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/post">
            
            <span>Posts</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#projects">
            
            <span>Projects</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/talk">
            
            <span>Talks</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
        

        <li class="nav-item">
          <a href="/#teaching">
            
            <span>Teaching</span>
            
          </a>
        </li>

        
        

        
        
        
        
        
          
            
          
        

        <li class="nav-item">
          <a href="http://cv.bryer.org" target="_blank" rel="noopener">
            
            <span>CV</span>
            
          </a>
        </li>

        
        
      

      
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  


  <div class="article-container">
    <h1 itemprop="name">Framework for Shiny Apps in R Packages</h1>

    

<div class="article-metadata">

  <span class="article-date">
    
    <time datetime="2021-02-12 00:00:00 &#43;0000 UTC" itemprop="datePublished dateModified">
      February 12, 2021
    </time>
  </span>
  <span itemscope itemprop="author publisher" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Jason Bryer, Ph.D.">
  </span>

  

  
  

  
  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fa fa-folder"></i>
    
    <a href="/categories/r">R</a
    >
    
  </span>
  
  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Framework%20for%20Shiny%20Apps%20in%20R%20Packages&amp;url=%2fpost%2f2021-02-12-shiny_apps_in_r_packages%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=%2fpost%2f2021-02-12-shiny_apps_in_r_packages%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fpost%2f2021-02-12-shiny_apps_in_r_packages%2f&amp;title=Framework%20for%20Shiny%20Apps%20in%20R%20Packages"
         target="_blank" rel="noopener">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=%2fpost%2f2021-02-12-shiny_apps_in_r_packages%2f&amp;title=Framework%20for%20Shiny%20Apps%20in%20R%20Packages"
         target="_blank" rel="noopener">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Framework%20for%20Shiny%20Apps%20in%20R%20Packages&amp;body=%2fpost%2f2021-02-12-shiny_apps_in_r_packages%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>


    <div class="article-style" itemprop="articleBody">
      
<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<p><strong>TL;DR:</strong> You can test this approach using this <a href="https://gist.github.com/jbryer/fc8834279189196ead710e89b56d7f88">Github Gist</a>.</p>
<p><a href="https://shiny.rstudio.com">R Shiny Apps</a> have become a popular way of creating web applications in R. There are many ways of running Shiny Apps including locally in <a href="https://rstudio.com/products/rstudio/">RStudio</a>, on <a href="http://www.shinyapps.io/">Shinyapps.io</a> or <a href="https://www.rstudio.com/products/shiny/shiny-server/">installing the server software</a> on your own host. I have been increasingly using Shiny apps as a way to demonstrate and interact with R Packages, especially packages I write for teaching purposes. Adding a Shiny app to an R package is relatively easy. In my use cases, I first put the application files (<code>server.R</code>, <code>ui.R</code>, and <code>global.R</code>) in the <code>inst/shiny</code> directory of my R package. I can then write a package function to run the Shiny app from the installed package directory using a function like this:</p>
<pre class="r"><code>#&#39; My Shiny App
#&#39; @export
my_shiny_app &lt;- function() {
    shiny::runApp(appDir = system.file(&#39;shiny&#39;, package=&#39;MY_PACKAGE_NAME&#39;))
}</code></pre>
<p>This works very well when the entire app is self-contained. However, this does not work if you want to pass parameters to the Shiny app. In my situation, I want to be able to pass different data frames that I can interact with, but still have the Shiny app work if not parameters are passed. The first step to get this to work is to convert the <code>server.R</code> and <code>ui.R</code> scripts to functions within the R package. The code is largely the same, but instead of calling the functions we are going to assign them to <code>shiny_server</code> and <code>shiny_ui</code>, respectively. I have also included some minimal <a href="https://github.com/r-lib/roxygen2">roxygen2</a> documentation. In particular, the functions need to be in the package’s export file.</p>
<pre class="r"><code>#&#39; The Shiny App Server.
#&#39; @param input input set by Shiny.
#&#39; @param output output set by Shiny.
#&#39; @param session session set by Shiny.
#&#39; @export
shiny_server &lt;- function(input, output, session) {
    if(!exists(&#39;thedata&#39;, envir = parent.env(environment()), inherits = FALSE)) {
        message(&#39;thedata not available, using default faithful...&#39;)
        data(faithful, envir = environment())
        thedata &lt;- faithful
    }

    output$environment &lt;- renderPrint(
        print(ls(envir = parent.env(environment())))
    )

    output$thedata &lt;- renderTable({
        return(thedata)
    })
}

#&#39; The Shiny App UI.
#&#39; @export
shiny_ui &lt;- function() {
    fluidPage(
        titlePanel(&#39;Shiny Parameter Test&#39;),
        verbatimTextOutput(&#39;environment&#39;),
        tableOutput(&#39;thedata&#39;)
    )
}</code></pre>
<p>This Shiny App doesn’t do a lot. It has one user variable, <code>thedata</code>, and the user interface includes the output of <code>ls</code> (i.e. what is in the executing environment) and the contents of <code>thedata</code> (presumed to be a data frame). The important feature here is the first five lines of the <code>shiny_server</code>. I first check to see if <code>thedata</code> exists using the <code>!exists('thedata', envir = parent.env(environment()), inherits = FALSE)</code> command. In short, if <code>thedata</code> is not present, I want to set it to a reasonable default value.</p>
<p>When encapsulating the Shiny app in R scripts, using the <code>runApp</code> function with the <code>appDir</code> parameter is sufficient. In order to pass variables to the Shiny app, we need to control the environment the app is started in. Below, is a rewrite of the <code>my_shiny_app</code> app. First, we create a new environment that will contain all of our parameters. Since specifying the parameter is optional, we use the <code>missing</code> function to check to see if it has a value, and if so assign it to the new environment. We then set the environment to our server and ui functions the newly created environment that now contains our parameters. The rest is similar to creating Shiny apps in a single <code>app.R</code> file; create the app with the <code>shinyApp</code> function and start it with the <code>runApp</code> function, but with the app instead of a directory.</p>
<pre class="r"><code>my_shiny_app &lt;- function(thedata, ...) {
    shiny_env &lt;- new.env()
    if(!missing(thedata)) {
        print(&#39;Setting parameters&#39;)
        assign(&#39;thedata&#39;, thedata, shiny_env)
    }
    environment(shiny_ui) &lt;- shiny_env
    environment(shiny_server) &lt;- shiny_env
    app &lt;- shiny::shinyApp(
        ui = shiny_ui,
        server = shiny_server
    )
    runApp(app, ...)
}</code></pre>
<p>We can now start the Shiny app with the <code>my_shiny_app()</code> function call. In the first instance, no parameters are passed to the app so the <code>faithful</code> data frame will be printed. The second and third calls will use the <code>iris</code> and <code>mtcars</code> data frames, respectively.</p>
<pre class="r"><code>my_shiny_app()
my_shiny_app(thedata = iris)
my_shiny_app(thedata = mtcars)</code></pre>
<div id="running-on-a-shiny-server" class="section level4">
<h4>Running on a Shiny server</h4>
<p>The one disadvantage of this approach is that it is more difficult to run the Shiny app outside the package and maintaining the app in two formats is inconvenient. There are two approaches to this:</p>
<p><strong>Option 1: A simple <code>app.R</code> script</strong></p>
<p>When using a single R script for shiny (i.e. <code>app.R</code>) the key is that teh script must call <code>shiny::shinyApp</code>. Similar to the <code>my_shiny_app</code> function above, we can simply call the function with our UI and server functions. In this script we are sourcing the <code>shiny_param_test.R</code> script but when in a package you would replace that with loading the package and references the UI and shiny functions in the package when calling <code>shinyApp</code>.</p>
<pre class="r"><code>library(shiny)
source(&#39;shiny_param_test.R&#39;)
shiny::shinyApp(ui = shiny_ui,
                server = shiny_server)</code></pre>
<p><strong>Option 2: Generate R scripts</strong></p>
<p>The <code>save_shiny_app</code> function below will save the server and ui functions in the package to a <code>server.R</code> and <code>ui.R</code> script files in the specified directory. Additionally, it will create a <code>global.R</code> file that loads the <code>shiny</code> package and any other required packages as specified in the <code>pkgs</code> parameter.</p>
<pre class="r"><code>#&#39; Save the Shiny App to ui.R, server.R, and global.R file.
#&#39;
#&#39; This function will create three files in the \code{out_dir}: \code{server.R},
#&#39; \code{ui.R}, and \code{global.R}. The contents of \code{server.R} and
#&#39; \code{ui.R} will be the source code of the \code{server_function} and
#&#39; \code{ui_function}, respectively. The \code{global.R} file will only contain
#&#39; \code{library} calls for \code{shiny} and any other packages specified in
#&#39; the \code{pkgs} parameter.
#&#39;
#&#39; If \code{run_app = TRUE} the function will start the Shiny app once the
#&#39; files are written. This is recommended to ensure all the necessary packages
#&#39; are loaded for the Shiny app to run.
#&#39;
#&#39; @param ui_function the function for the UI.
#&#39; @param server_function the function for the server.
#&#39; @param pkgs any packages that need to be loaded for the app to work. At
#&#39;        minimum the package containing the shiny app should be included.
#&#39; @param out_dir the directory to save the shiny app files.
#&#39; @param run_app whether to run the app once the files are saved.
save_shiny_app &lt;- function(ui_function,
                           server_function,
                           pkgs,
                           out_dir = &#39;shiny&#39;,
                           run_app = interactive()) {
    server_txt &lt;- capture.output(server_function)
    ui_txt &lt;- capture.output(ui_function)
    # Remove the bytecode and environment info
    server_txt &lt;- server_txt[1:(length(server_txt)-2)]
    ui_txt &lt;- ui_txt[3:(length(ui_txt)-3)]
    # Fix the function assignment
    server_txt[1] &lt;- &#39;shinyServer(function(input, output, session)&#39;
    server_txt[length(server_txt)] &lt;- &#39;})&#39;
    global_txt &lt;- c(&quot;library(&#39;shiny&#39;)&quot;)
    if(!missing(pkgs)) {
        global_txt &lt;- c(global_txt, paste0(&quot;library(&#39;&quot;, pkgs, &quot;&#39;)&quot;))
    }
    # Save the shiny app files
    cat(server_txt, sep = &#39;\n&#39;, file = paste0(out_dir, &#39;/server.R&#39;))
    cat(ui_txt, sep = &#39;\n&#39;, file = paste0(out_dir, &#39;/ui.R&#39;))
    cat(global_txt, sep = &#39;\n&#39;, file = paste0(out_dir, &#39;/global.R&#39;))
    # Start the app
    if(run_app) {
        runApp(appDir = out_dir)
    }
}</code></pre>
</div>

    </div>

    


<div class="article-tags">
  
  <a class="btn btn-primary btn-outline" href="/tags/r">R</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/r-bloggers">R-Bloggers</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/shiny">Shiny</a>
  
  <a class="btn btn-primary btn-outline" href="/tags/r-packages">R Packages</a>
  
</div>




    
    
    <div class="article-widget">
      <div class="hr-light"></div>
      <h3>Related</h3>
      <ul>
        
        <li><a href="/post/2018-22-26-dtedit/">Editable DataTables for Shiny Applications</a></li>
        
        <li><a href="/post/2016-02-22-assessments_with_shiny/">Conducting Assessments and Surveys with Shiny</a></li>
        
        <li><a href="/post/2016-02-21-bayes_billiards_shiny/">Shiny App for Bayes Billiards Problem</a></li>
        
        <li><a href="/post/2014-07-29-data_caching/">Data Caching</a></li>
        
        <li><a href="/post/2014-07-04-women_graduates_in_math_stats_cis/">Women Graduates in Math, Statistics, and Computer Information Systems</a></li>
        
      </ul>
    </div>
    

    

    
<section id="comments">
  <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "jbryer" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>



  </div>
</article>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      &copy; 2020 &middot; 

      Powered by the
      <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
      <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.
      <br/>Some <a href="http://www.bryer.org/tags/r-bloggers/">posts</a> generously redistributed by <a href="https://www.r-bloggers.com/" target="_blank">R-Bloggers</a>.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close btn-large" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Cite</h4>
      </div>
      <div>
        <pre><code class="modal-body tex"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-primary btn-outline js-copy-cite" href="#" target="_blank">
          <i class="fa fa-copy"></i> Copy
        </a>
        <a class="btn btn-primary btn-outline js-download-cite" href="#" target="_blank">
          <i class="fa fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    

    

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha512-3P8rXCuGJdNZOnUx/03c1jOTnMn3rP63nBip5gOP2qmUh5YAdVAvFZ1E+QLZZbC1rtMrQb+mah3AfYW11RUrWA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha512-iztkobsvnjKfAtTNdHkGVjAYTrrtlC7mGp/54c40wowO7LhURYl3gVzzcEqGl/qKXQltJ2HwMrdLcNUdo+N/RQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>
    
    
    <script src="/js/hugo-academic.js"></script>
    

    
    
      
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
      

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    

  </body>
</html>

